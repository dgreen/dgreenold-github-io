<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: developer | Glimmer]]></title>
  <link href="http://dgreen.github.io/blog/categories/developer/atom.xml" rel="self"/>
  <link href="http://dgreen.github.io/"/>
  <updated>2013-06-06T15:32:02-05:00</updated>
  <id>http://dgreen.github.io/</id>
  <author>
    <name><![CDATA[David Green]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Using Bitnami's Rubystack on VirtualBox Linux with Vagrant]]></title>
    <link href="http://dgreen.github.io/blog/2013/06/06/using-bitnamis-rubystack-on-virtualbox-linux-with-vagrant/"/>
    <updated>2013-06-06T01:36:00-05:00</updated>
    <id>http://dgreen.github.io/blog/2013/06/06/using-bitnamis-rubystack-on-virtualbox-linux-with-vagrant</id>
    <content type="html"><![CDATA[<p>In my Software Engineering Projects class, we are going to do a RAILS-based
project.  Based on feedback from last year&rsquo;s class, I am furnishing students
with an almost configured RAILS system for development.  The system is based on</p>

<ul>
<li><a href="http://bitnami.com/stack/ruby" title="Ruby Stack Cloud Hosting, Installers and Virtual Machines. - BitNami">Bitnami&rsquo;s Rubystack for 32 bit Linux</a></li>
<li><a href="https://www.virtualbox.org/" title="Oracle VM VirtualBox">VirtualBox 4.2.12</a> as the VM</li>
<li><a href="http://www.vagrantup.com/" title="Vagrant">Vagrant 1.22</a> to help manage the install</li>
<li><a href="http://releases.ubuntu.com/precise/" title="Ubuntu 12.04.2 LTS (Precise Pangolin) - Ubuntu Releases">Ubuntu precise32</a> Linux</li>
</ul>


<h2>Create the base machine</h2>

<p>The <code>Vagrantfile</code> is configured to support networking from the host machine
and to run a configuration script (<code>script.sh</code>) as part of the provisioning.
There is a small bit of logic to avoid re-provisioning things each time the
machine is brought up.</p>

<p>I make it by following roughly the following procedure:</p>

<ol>
<li> Install Virtualbox</li>
<li> Install Vagrant</li>
<li> Create a directory to place files add in

<ul>
<li>The bitnami linux installer file</li>
<li><code>Vagrantfile</code></li>
<li><code>script.sh</code></li>
</ul>
</li>
<li> Do an install:  <code>vagrant up</code></li>
<li> SSH into the running host:  <code>vagrant ssh</code></li>
<li> Use Linux as needed</li>
<li> Exit back to the host OS:  <code>exit</code></li>
<li> Shutdown the virtual machine (saving the contents):  <code>vagrant halt</code></li>
<li><p> Package the machine post configuration with <code>vagrant package default --output rails3r2e13.box</code></p></li>
<li><p> Restart the machine and continue work:  <code>vagrant up</code></p></li>
</ol>


<h2>Install the base machine on student computer</h2>

<p>OS X/Linux commands are given here, change the direction of the / (to &lsquo;\&rsquo;) for Windows.</p>

<ol>
<li> Install Virtualbox</li>
<li> Install Vagrant</li>
<li> Create a vms directory for your development use <code>mkdir vms</code></li>
<li> Create a machine1 directory <code>mkdir vms/machine1</code>  It will be accessible to both
 Linux and your operating system.</li>
<li> <code>cd vms/machine1</code></li>
<li> <code>vagrant init rails3r2e13.box url_to_image</code></li>
<li> uncomment <code>config.vm.network :private_network, ip: "192.168.33.10"</code> in Vagrantfile</li>
<li> <code>vagrant up</code>              # first time will download the vm machine</li>
<li> <code>vagrant ssh</code>             # if this fails, you need to put SSH on the path</li>
</ol>


<h2>SSH for Windows</h2>

<p>Windows does not include SSH by default.  Two options are to 1) install Git locally and then use it&rsquo;s SSH implementation and 2) <a href="http://docs-v1.vagrantup.com/v1/docs/getting-started/ssh.html">install PuTTY</a>.</p>

<h2>Limitations</h2>

<p>The file <code>.bashrc</code> has a line at the end of it that maps the rails commands onto
the path along with library linkage as well.  This messes up some local commands
<code>nano</code> and others.  One solution is to comment out the line and re-log into the
VM.</p>

<h2>Other vagrant commands</h2>

<ul>
<li><code>vagrant destroy</code>  eliminate the virtual machine so next time it will be rebuilt</li>
<li><code>vagrant reload</code>  combination of of halt then up</li>
<li><code>vagrant suspend</code> pause machine copying state to disk, resume with `vagrant resule``</li>
</ul>


<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>Vagrantfile </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="o">&amp;</span><span class="n">ndash</span><span class="p">;</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;&amp;</span><span class="n">ndash</span><span class="p">;</span> <span class="ss">mode</span><span class="p">:</span> <span class="n">ruby</span> <span class="o">&amp;</span><span class="n">ndash</span><span class="p">;</span><span class="o">&lt;</span><span class="sr">/em&gt;&amp;ndash;&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="ss">vi</span><span class="p">:</span> <span class="n">set</span> <span class="n">ft</span><span class="o">=</span><span class="n">ruby</span> <span class="p">:</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;Vagrant.configure(&amp;ldquo;2&amp;rdquo;) do |config|</span>
</span><span class='line'><span class="sr">  # Every Vagrant virtual environment requires a box to build off of.</span>
</span><span class='line'><span class="sr">  config.vm.box = &amp;ldquo;precise32&amp;rdquo;</span>
</span><span class='line'><span class="sr">  config.vm.box_url = &amp;ldquo;&lt;a href=&quot;http:/</span><span class="o">/</span><span class="n">files</span><span class="o">.</span><span class="n">vagrantup</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">precise32</span><span class="o">.</span><span class="n">box</span><span class="s2">&quot;&gt;http://files.vagrantup.com/precise32.box&lt;/a&gt;&amp;rdquo;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&lt;p&gt;  # Create a private network, which allows host-only access to the machine</span>
</span><span class='line'><span class="s2">  # using a specific IP.</span>
</span><span class='line'><span class="s2">  config.vm.network :private_network, ip: &amp;ldquo;192.168.33.10&amp;rdquo;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&lt;p&gt;  # Share an additional folder to the guest VM. The first argument is</span>
</span><span class='line'><span class="s2">  # the path on the host to the actual folder. The second argument is</span>
</span><span class='line'><span class="s2">  # the path on the guest to mount the folder. And the optional third</span>
</span><span class='line'><span class="s2">  # argument is a set of non-required options.</span>
</span><span class='line'><span class="s2">  # config.vm.synced_folder &amp;ldquo;../data&amp;rdquo;, &amp;ldquo;/vagrant_data&amp;rdquo;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&lt;p&gt;  # Provider-specific configuration so you can fine-tune various</span>
</span><span class='line'><span class="s2">  # backing providers for Vagrant. These expose provider-specific options.</span>
</span><span class='line'><span class="s2">  config.vm.provision :shell, :path =&gt; &amp;ldquo;script.sh&amp;rdquo;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&lt;p&gt;end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>script.sh </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;!/usr/bin/env bash&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;set -e      <span class="c"># Exit script on error</span>
</span><span class='line'><span class="nb">set</span> -x      <span class="c"># Print commands and arguments&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'>&lt;p&gt;echo &amp;ldquo;Starting configuration script&amp;rdquo;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Abort provisioning <span class="k">if </span>rubystack is already installed.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;test -d /opt/rubystack-1.9.3-10 &amp;amp;&amp;amp;
</span><span class='line'><span class="o">{</span> <span class="nb">echo</span> &amp;ldquo;rubystack already installed.&amp;rdquo;; <span class="nb">exit </span>0; <span class="o">}</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;echo &amp;ldquo;Provisioning rubystack from bitnami&amp;rdquo;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Install bitnami&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;/vagrant/bitnami-rubystack-1.9.3-10-linux-installer.run &amp;mdash;mode unattended <span class="se">\&lt;</span>/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;                              --disable-components varnish,phpmyadmin,rvm
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;install the quiet_assets gem&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;gem install quiet_assets -f &amp;mdash;install-dir /opt/rubystack-1.9.3-10/ruby/lib/ruby/gems/1.9.1&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;make vagrant user owner of the install&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;chown -R vagrant.vagrant /opt/rubystack-1.9.3-10&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;install a symbolic link to rubystack directory&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;ln -s /opt/rubystack-1.9.3-10 /home/vagrant/rubystack&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;put ruby / rails code on path&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;echo &amp;ldquo;. /opt/rubystack-1.9.3-10/scripts/setenv.sh&amp;rdquo; &gt;&gt; /home/vagrant/.bashrc&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;echo &amp;ldquo;Provisioning complete.&amp;rdquo;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
</feed>
